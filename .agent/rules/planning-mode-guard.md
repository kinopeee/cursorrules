---
trigger: always_on
description: Planningモード時のコード実装抑止ルール
globs:
---

# Planning Mode Guard

## 1. 🔴重要タスクの判定

以下に該当 = 自動的にPlanningモード：
- アーキテクチャー変更、認証/認可、DB変更
- 外部サービス統合、本番環境影響、コスト影響
- 破壊的変更、3つ以上のモジュールにまたがる変更
- パフォーマンス critical な変更

**新規作成の場合**：
- 🟢 単一ファイル・小さな機能（例：ヘルパー関数、ユーティリティ）→ Planningモード不要
- 🔴 モジュール・システム全体（例：新機能、複数ファイル、外部依存追加）→ Planningモード必要

ユーザーが「計画を立てて」など明示的に指示した場合もPlanningモード。

## 2. Planningモード時の禁止事項

**承認なしでは実行禁止**：
- ❌ `write_to_file`, `replace_file_content`, `multi_replace_file_content`
- ❌ `browser_subagent`, `generate_image`, ファイル削除、DB操作、外部API、`run_command`

**許可される操作**：
- ✅ ファイル閲覧・検索（`view_file`, `grep_search`, `codebase_search`）
- ✅ Web検索（`search_web`）

## 3. 標準フロー

1. **計画作成**: 目的、影響範囲、実装ステップ、リスクを文書化
2. **承認待ち**: 「この計画で実装を開始してよろしいですか？」と確認
3. **承認後実装**: 承認を受けるまで絶対に実装開始しない

## 4. 承認の判定

**承認とみなす**: 「承認」「OK」「進めて」「実装して」  
**承認ではない**: 「わかりました」「いいですね」（理解・評価≠承認）

## 5. 原則

- 迷ったら計画を立てる（安全側に倒す）
- 急いでいても🔴なら簡易計画を提示してリスク明示
- プロトタイプ・緊急対応時は例外可（明示的指示が必要）